- defaults:
    link:
        create: true
        relink: true
        force: true

- clean: ['~', '~/.config']

- link:
    ~/.config/user-dirs.dirs: config/user-dirs
    ~/.icons: icons
    ~/.fonts: fonts
    ~/.ghci: ghci/ghcirc
    ~/.ptpython/config.py: ptpython/ptpython_config.py
    ~/.config/rofi/rofi-theme.rasi: rofi/rofi-theme.rasi
    ~/.spacemacs: spacemacs/init.el
    ~/.themes: themes
    ~/.tmux.conf: tmux/tmux.conf
    ~/.vim: vim/vim
    ~/.vimrc: vim/vimrc
    ~/.Xresources: Xresources/Xresources
    ~/.Xresources.d/rofi.conf: rofi/Xresources.conf
    ~/.zshrc: zsh/zshrc
    ~/.zshenv: zsh/env

- shell:
    - command: 
        'setup_git () {
           echo "Enter your full name (for git identifaction):" &&
           read USER_FULLNAME &&
           echo "Enter your email address (for git identification):" &&
           read USER_EMAIL &&
           cat git/gitconfig |
               sed "/name =\W*$/  s/name.*$/name = "$USER_FULLNAME"/" |
               sed "/email =\W*$/ s/email.*$/email = "$USER_EMAIL"/" >
               $HOME/.gitconfig;
        } &&
        GIT_FILLED_FIELDS=$(test -f $HOME/.gitconfig && cat $HOME/.gitconfig | grep -e "\(name\|email\) = \w\+" | wc -l || echo 0) &&
        if [ $GIT_FILLED_FIELDS = 2 ]; then
            echo "git already set up";
        else
            setup_git;
        fi'
      stdin: true
      stdout: true
      description: Configuring git name and e-mail address
    - [git submodule update --init --recursive --depth 1 || git submodule update --recursive --depth 1, Updating submodules]

    # offline actions
    - [mkdir ~/doc/desktop -p && mkdir ~/tmp -p && mkdir ~/doc/music -p && mkdir ~/doc/images -p && mkdir ~/.templates -p && mkdir ~/doc/shared -p && mkdir ~/doc/videos -p, Creating dirs for user-dirs]
    - [xdg-user-dirs-update && (xdg-user-dirs-gtk-update || echo), Updating user-dirs]
    - [ls ~/.ssh/*.pub || (ssh-keygen -t rsa -f $HOME/.ssh/id_rsa && ssh-keygen -t rsa -f $HOME/.ssh/id_rsa_nopasswd -N ""), Generating ssh keys]
    - [xrdb -load ~/.Xresources, Loading Xresources config]

    # actions requiring the Internet
    - ["sudo apt install vim
                         zsh
                         emacs25
                         xsel
                         keychain
        ", Installing packages]
    - command:
        'vim +PlugInstall +qall'
      description: Installing vim plugins
      stdout: true
    - ["[ -d ~/.oh-my-zsh ] || git clone git://github.com/robbyrussell/oh-my-zsh.git ~/.oh-my-zsh", Installing oh-my-zsh]
    - command:
        'if [ `echo $SHELL | grep zsh | wc -l` = 0 ]; then
          echo "password:" &&
          chsh -s /bin/zsh;
        fi'
      stdin: true
      stdout: true
      description: Setting zsh as a default shell
    - [ls ~/.dotfiles/icons/*Papirus* || ln -s ~/.dotfiles/icons/.repositories/papirus-icon-theme/*Papirus* ~/.dotfiles/icons/, Installing Papirus icons]
    - ["cd ~/.dotfiles/themes/.repositories/arc-theme &&
        ./autogen.sh --prefix=$HOME/.dotfiles --datarootdir=$HOME/.dotfiles &&
        make install &&
        cd ~/.dotfiles", Installing Arc-theme]
    - command:
        '[ -d ~/.emacs.d ] ||
         git clone https://github.com/syl20bnr/spacemacs ~/.emacs.d'
      stdout: true
      description: Installing spacemacs
